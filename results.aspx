<%@ Page Language="VB" AutoEventWireup="false" CodeFile="results.aspx.vb" Inherits="results" MasterPageFile="~/MasterPage.master" %>


<asp:Content runat="server" ContentPlaceHolderID="ContentArea">


    <h1>Результаты клубных игр</h1>
    <div>
        Нажмите на любую команду, чтобы попасть на <strong>страницу команды</strong>. <br />Хотите знать, что означают маленькие значки, рядом с названиями команд? Вам <a href="/team-bonus.aspx">сюда</a>.
    </div>

    <div class="tab-buttons">
        <a href="/results.aspx" class="tab-l <%= If(IsShowPoints, "", "active") %>">
            Показать занятые места
        </a><a href="/results.aspx?mode=points" class="tab-r <%= If(IsShowPoints, "active", "") %>">
            Показать очки
        </a>
    </div>

    <table class="results-table">
        <tr>
            <td rowspan="2">№</td>
            <td rowspan="2">Команда</td>
            <td colspan="<%= GameResult.All.Count %>"><%= If(IsShowPoints, "Набранные очки", "Занятое место")%></td>
            <td rowspan="2">Рейтинг*</td>
        </tr>
        <tr>
            <%For i = 0 To GameResult.All.Count - 1
                    Dim gameNum = GameResult.All.Keys(i)
                    Dim cls = ""
                    Dim j = i + 1
                    If j <= 6 Then
                        cls = 1
                    ElseIf j <= 12 Then
                        cls = 2
                    ElseIf j <= 18 Then
                        cls = 3
                    ElseIf j <= 24 Then
                        cls = 4
                    Else
                        cls = 5
                    End If
                    %>
            <td class="game-num-<%= cls %>"><%= gameNum %> игра</td>
            <%Next %>
        </tr>

            <%  Dim n = 1, n1 = 1, prevR = 0
                For Each t In Team.All.Values.OrderByDescending(Function(x) x.CurrentMoonRating)
                    If prevR <> t.CurrentMoonRating Then n1 = n
                     %>
        <tr>
            <td><%= n1 %></td>
            <td>
                <a href="<%= t.FullUrl %>"><%= t.Name %></a>


                <%if t.IsBestMaximumRating %>
                <span title="Наивысший максимальный рейтинг среди всех команд (<%= t.MaxinumMoonRating %>)">
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 297 297" width="20" fill="#a53a00">
		                <path d="M25.282,220.174V261.9c0,5.422,4.396,9.818,9.817,9.818h226.8c5.423,0,9.818-4.397,9.818-9.818v-41.727H25.282z" />
		                <path d="M272.243,206.428c1.928-17.027,8.827-54.652,14.238-82.127C292.676,121.475,297,115.24,297,108    c0-9.881-8.038-17.918-17.918-17.918c-9.881,0-17.919,8.037-17.919,17.918c0,3.205,0.856,6.209,2.337,8.816l-16.17,16.17    c-4.822-11.35-7.186-28.85-7.824-42.23c5.039-3.174,8.403-8.773,8.403-15.156c0-9.879-8.038-17.918-17.918-17.918    c-9.881,0-17.919,8.039-17.919,17.918c0,4.453,1.643,8.523,4.34,11.66c-10.464,18.023-25.075,35.371-34.143,45.428    c-7.97-16.629-16.955-49.719-22.526-75.555c4.065-3.287,6.675-8.309,6.675-13.932c0-9.881-8.037-17.92-17.918-17.92    c-9.881,0-17.918,8.039-17.918,17.92c0,5.623,2.609,10.646,6.677,13.932c-5.57,25.838-14.555,58.932-22.529,75.561    c-9.063-10.047-23.667-27.381-34.143-45.434c2.698-3.137,4.34-7.207,4.34-11.66c0-9.879-8.037-17.918-17.918-17.918    c-9.88,0-17.918,8.039-17.918,17.918c0,6.387,3.367,11.986,8.409,15.16c-0.629,13.379-2.99,30.877-7.824,42.232L33.5,116.816    c1.48-2.607,2.336-5.611,2.336-8.816c0-9.881-8.037-17.918-17.918-17.918C8.038,90.082,0,98.119,0,108    c0,7.24,4.324,13.475,10.519,16.301c5.411,27.473,12.31,65.098,14.238,82.127H272.243z M148.5,154.883    c9.881,0,17.918,8.037,17.918,17.918c0,9.881-8.037,17.918-17.918,17.918c-9.881,0-17.918-8.037-17.918-17.918    C130.582,162.92,138.619,154.883,148.5,154.883z"/>
                    </svg>
                </span>
                <%End If %>

                <%If t.MaxinumMoonRating = t.CurrentMoonRating And t.GameResults.Count > 3 %>
                <span title="Команда жжет! (текущий рейтинг самый высокий за все время игр)">
                    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 511.269 511.269" width="20">
                        <path style="fill:#F3705A;" d="M140.367,465.067C116.9,438.4,93.434,410.667,78.5,377.6c-14.933-35.2-19.2-75.733-11.733-114.133
	                        s24.533-74.667,49.067-105.6c-2.133,26.667,7.467,54.4,25.6,74.667c-10.667-51.2,6.4-106.667,40.533-147.2S263.034,18.133,312.1,0
	                        c-24.533,25.6-27.733,66.133-18.133,100.267c9.6,34.133,29.867,64,48,94.933c18.133,30.933,35.2,62.933,36.267,98.133
	                        c9.6-18.133,20.267-36.267,26.667-56.533c6.4-20.267,9.6-41.6,4.267-61.867c19.2,23.467,29.867,46.933,35.2,76.8
	                        c5.333,29.867,4.267,60.8,1.067,90.667c-4.267,33.067-12.8,67.2-30.933,94.933c-21.333,33.067-55.467,56.533-92.8,69.333
	                        C255.567,518.4,190.5,508.8,140.367,465.067z"/>
                        <path style="fill:#FFD15C;" d="M221.434,504.533C308.9,538.667,395.3,435.2,347.3,355.2c0-1.067-1.067-1.067-1.067-2.133
	                        c4.267,43.733-6.4,75.733-26.667,93.867c10.667-25.6,3.2-55.467-9.6-81.067c-12.8-24.533-30.933-46.933-44.8-70.4
	                        c-13.867-24.533-24.533-52.267-18.133-80c-25.6,19.2-43.733,48-51.2,78.933c-7.467,30.933-3.2,65.067,10.667,93.867
	                        c-16-11.733-27.733-30.933-28.8-51.2c-17.067,20.267-27.733,46.933-26.667,73.6C151.034,452.267,184.1,489.6,221.434,504.533z"/>
                    </svg>
                </span>
                <%End If %>

                <%If t.AboutText IsNot Nothing AndAlso t.AboutText.Length > 250 %>
                <span title="Волшебный пергамент! Нажмите на команду, чтобы прочитать ее историю">
                  <svg version="1.1" width="20" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="green" viewBox="0 0 539.077 539.077">
		            <path d="M348.154,539.077H78.615C35.272,539.077,0,503.805,0,460.462s35.272-78.615,78.615-78.615h33.692V78.615
			            C112.308,35.272,147.579,0,190.923,0h269.538c1.119,0,2.215,0.165,3.224,0.472C466.318,0.165,468.994,0,471.692,0
			            c39.681,0,67.385,32.332,67.385,78.615c0,6.208-5.023,11.231-11.231,11.231H426.769v370.615
			            C426.769,503.805,391.498,539.077,348.154,539.077z M348.154,404.308c-30.972,0-56.154,25.182-56.154,56.154
			            s25.181,56.154,56.154,56.154s56.154-25.181,56.154-56.154V67.385c0-17.241,6.515-32.99,17.197-44.923H190.923
			            c-30.961,0-56.154,25.192-56.154,56.154v303.231h213.385c6.208,0,11.231,5.023,11.231,11.231
			            C359.385,399.285,354.361,404.308,348.154,404.308z M78.615,404.308c-30.961,0-56.154,25.182-56.154,56.154
			            s25.192,56.154,56.154,56.154h214.569c-14.587-14.28-23.646-34.175-23.646-56.154c0-21.979,9.059-41.874,23.646-56.154H78.615z
			             M426.769,67.385h89.122c-3.575-27.287-20.444-44.923-44.199-44.923C446.928,22.462,426.769,42.609,426.769,67.385z
			             M325.692,336.923H202.154c-6.208,0-11.231-5.023-11.231-11.231c0-6.208,5.023-11.231,11.231-11.231h123.538
			            c6.208,0,11.231,5.023,11.231,11.231C336.923,331.9,331.9,336.923,325.692,336.923z M325.692,269.538H202.154
			            c-6.208,0-11.231-5.023-11.231-11.231c0-6.208,5.023-11.231,11.231-11.231h123.538c6.208,0,11.231,5.023,11.231,11.231
			            C336.923,264.515,331.9,269.538,325.692,269.538z M325.692,202.154H202.154c-6.208,0-11.231-5.023-11.231-11.231
			            c0-6.208,5.023-11.231,11.231-11.231h123.538c6.208,0,11.231,5.023,11.231,11.231C336.923,197.131,331.9,202.154,325.692,202.154z
			             M325.692,134.769H202.154c-6.208,0-11.231-5.023-11.231-11.231s5.023-11.231,11.231-11.231h123.538
			            c6.208,0,11.231,5.023,11.231,11.231S331.9,134.769,325.692,134.769z"/>
                    </svg>
                </span>
                <%End If %>

                <%If t.Name = "Deja Vu" Then %>
                <span title="У этой команды сейчас находится БОЛЬШАЯ ФИЛАДЕЛЬФИЙСКАЯ СОВА">
                <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="20" viewBox="0 0 31.323 31.322" xml:space="preserve">
		            <path d="M19.224,8.009c-0.111,0-0.22,0.01-0.327,0.023c0.126,0.143,0.205,0.32,0.205,0.516c0,0.465-0.428,0.842-0.952,0.842
			            c-0.37,0-0.688-0.189-0.847-0.464c-0.237,0.32-0.377,0.702-0.377,1.113c0,1.122,1.029,2.031,2.298,2.031
			            c1.27,0,2.3-0.909,2.3-2.031S20.494,8.009,19.224,8.009z"/>
		            <path d="M11.415,12.08c1.275,0,2.311-0.913,2.311-2.041s-1.036-2.041-2.311-2.041c-0.242,0-0.477,0.032-0.696,0.095
			            c0.096,0.132,0.154,0.287,0.154,0.455c0,0.465-0.426,0.842-0.952,0.842c-0.232,0-0.441-0.076-0.606-0.198
			            c-0.134,0.259-0.21,0.544-0.21,0.848C9.104,11.167,10.139,12.08,11.415,12.08z"/>
		            <path d="M23.17,13.652c0,0-0.086,0.067-0.229,0.193c0.447-0.803,0.695-1.729,0.695-2.769c0-1.59-0.31-2.721-1.293-3.916
			            c0.197-0.208,0.32-0.474,0.406-0.754l0.094-0.027V5.987c0.084-0.55,0.045-1.098,0-1.422V1.498h1.688V4.96h-0.843v2.929h2.625V4.96
			            H25.75V1.498h1.032V0H3.901v1.498h3.47V6.38l0.875,0.244c0.081,0.196,0.18,0.384,0.325,0.537
			            c-0.983,1.195-1.293,2.326-1.293,3.916c0,1.131,0.293,2.127,0.815,2.979c-0.039,0.06-0.08,0.119-0.117,0.181
			            c-1.195,0.354-4.599,1.832-3.26,6.998c1.61,6.223,6.145,8.826,6.145,8.826s0.17-0.252,0.406-0.722
			            c0.167,1.117,1.299,1.983,2.67,1.983c0.981,0,1.84-0.446,2.312-1.108c0.494,0.493,1.232,0.81,2.06,0.81
			            c1.485,0,2.694-1.019,2.694-2.269c0-0.021-0.004-0.041-0.004-0.063c0.34,0.632,0.596,0.974,0.596,0.974s4.38-2.802,5.636-9.087
			            C28.484,14.292,23.17,13.652,23.17,13.652z M22.653,10.039c0,1.67-1.538,3.029-3.429,3.029c-1.892,0-3.428-1.359-3.428-3.029
			            c0-0.662,0.25-1.27,0.658-1.769l3.766-1.115C21.624,7.536,22.653,8.678,22.653,10.039z M15.342,8.6l0.152-0.046
			            C15.461,8.62,15.42,8.683,15.39,8.751c-0.024-0.057-0.06-0.107-0.087-0.162L15.342,8.6z M15.438,11.518
			            c0.783,0.046,0.846,0.794,0.846,0.794l-0.811,0.936l-0.976-0.936C14.498,12.312,14.653,11.473,15.438,11.518z M21.822,6.777
			            l-0.264,0.28c-0.115-0.071-0.24-0.129-0.364-0.19l0.695-0.205C21.865,6.697,21.851,6.745,21.822,6.777z M9.421,6.95
			            C9.384,6.97,9.344,6.985,9.308,7.006l-0.11-0.117L9.421,6.95z M10.358,7.211l4.026,1.122c0.377,0.486,0.6,1.073,0.6,1.706
			            c0,1.67-1.538,3.029-3.428,3.029c-1.891,0-3.429-1.359-3.429-3.029C8.128,8.743,9.059,7.643,10.358,7.211z M13.937,30.422
			            c-0.924,0-1.677-0.613-1.677-1.367c0-0.756,0.753-1.369,1.677-1.369c0.924,0,1.676,0.613,1.676,1.369
			            C15.613,29.809,14.861,30.422,13.937,30.422z M18.307,30.122c-0.924,0-1.678-0.613-1.678-1.367c0-0.755,0.754-1.369,1.678-1.369
			            s1.676,0.614,1.676,1.369C19.983,29.509,19.231,30.122,18.307,30.122z M19.301,21.511c-0.051,2.376,0.474,4.347,1.033,5.755
			            c-0.494-0.478-1.221-0.779-2.027-0.779c-0.982,0-1.842,0.447-2.312,1.108c-0.494-0.493-1.234-0.809-2.059-0.809
			            c-0.743,0-1.417,0.255-1.904,0.665c0.457-1.419,0.831-3.354,0.652-5.639c-0.188-2.387-1.198-4.254-2.193-5.552
			            c1.377,0.753,3.098,1.154,4.966,1.159c2.282-0.005,4.344-0.604,5.829-1.711C20.331,17.055,19.357,19.023,19.301,21.511z
			             M15.458,16.82c-3.83-0.008-6.994-1.787-7.445-4.954c0.714,1.076,2.034,1.803,3.544,1.803c1.126,0,2.146-0.404,2.889-1.054
			            l0.084,0.079l0.929,1.243l0.934-1.278c0.736,0.624,1.734,1.01,2.833,1.01c1.638,0,3.051-0.854,3.709-2.082
			            C22.635,14.928,19.399,16.812,15.458,16.82z"/>                </svg></span>
                <%End If%>
            </td>
            <%
                For index = 0 To GameResult.All.Count - 1
                    Dim ii = index
                    Dim g = t.GameResults.FirstOrDefault(Function(x) x.GameNum = GameResult.All.Keys(ii))

                    Dim med = "-"
                    Dim mr = ""
                    If g IsNot Nothing Then
                        mr = g.AdjustedMoodRating
                        Dim p = Math.Round(g.AdjustedMoodRating / g.MoonRatingBase * 100)
                        If Math.Abs(p - 75) < 3 Then p = 75
                        If Math.Abs(p - 50) < 3 Then p = 50
                        mr &= " (временной коэфициент " & p / 100.0 & ")"
                        If g.Position <= 3 Then med = "<span class='medal-" & g.Position & "'>" & g.Position & "</span>" Else med = g.Position
                        If IsShowPoints Then med = If(g.Points = 0, "?", g.Points)
                    End If



            %>
            <td><span style="cursor: default" title="Бонус игры <%= mr %>"><%= med %></span></td>
            <%Next%>
            <td><span style="cursor:default" title="Максимальный рейтинг: <%= t.MaxinumMoonRating %>"><%= t.CurrentMoonRating %></span>
<%--                <div class="rating-max">(макс. <%= t.MaxinumMoonRating %>)</div>--%>

            </td>
        </tr>
                <% 
                        prevR = t.CurrentMoonRating
                        n += 1
                    Next%>

    </table>

    <div class="note">
        * рейтинг считается по модицифированной системе Муна. Рейтинг учитывает активность команды и ее результаты.
    </div>


</asp:Content>
